import{r as c,R as e,n as V,U as ee,d as u,b as p,e as F,p as R,t as we,v as Ee,c as g,w as U,q as B,g as M,u as ye,x as ve,h as Ne,y as ke,j as X,k as Ce,l as Se,m as Pe,z as De,A as Ue,B as Fe,f as Y,C as Z}from"./index-H4Aju8zv.js";import{F as Re,a as $e}from"./index-PwullOj6.js";import{B as _e}from"./blogCard-rB7cQR1E.js";const Be=({isOpen:f,onRequestClose:t,onUpload:O,onFileChange:y})=>{const[v,h]=c.useState(!1),b=i=>{y(i.target.files[0])},o=async()=>{try{h(!0),await O(),t()}catch(i){console.error("Error uploading file:",i)}finally{h(!1)}};return e.createElement("div",{className:`fixed top-0 left-0 w-full h-full flex items-center justify-center ${f?"":"hidden"}`},e.createElement("div",{className:"absolute w-full h-full bg-gray-800 opacity-75",onClick:t}),e.createElement("div",{className:"bg-white rounded-lg overflow-hidden z-10"},e.createElement("span",{className:"absolute top-0 right-0 cursor-pointer text-3xl px-4 py-2",onClick:t},"×"),e.createElement("div",{className:"p-6"},e.createElement("h2",{className:"text-2xl font-bold mb-4"},"Edit Profile Picture"),e.createElement("input",{type:"file",onChange:b,className:"mb-4"}),e.createElement("button",{onClick:o,className:"bg-blue-500 text-white py-2 px-4 rounded"},v?"Uploading...":"Upload"))))},Me=()=>{const[f,t]=c.useState({bio:"",username:"",title:""}),[O,y]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const N=p(u,"users",V.currentUser.uid),E=await F(N);if(E.exists){const k=E.data();t({bio:k.bio,username:k.username,title:k.title})}}catch(N){console.error("Error fetching user data:",N)}finally{y(!1)}})()},[V.currentUser]);const v=x=>{t({...f,[x.target.name]:x.target.value})},h=c.useContext(ee),b=h==null?void 0:h.uid,[o,i]=c.useState(!0),A=()=>{i(!1)},T=async()=>{try{y(!0);const x=p(u,"users",b),N={bio:f.bio,username:f.username,title:f.title};await R(x,N);const E=we();await Ee(E.currentUser,{displayName:f.username});const k=B(g(u,"post"),U("createdBy","==",E.currentUser.uid));(await M(k)).forEach(async C=>{try{const S=p(u,"post",C.id);(await F(S)).exists()?await R(S,{username:E.currentUser.displayName}):console.error(`Post document ${C.id} not found`)}catch(S){console.error(`Error updating post ${C.id}:`,S)}}),console.log("Document successfully added!"),t({bio:"",username:"",title:""}),A()}catch(x){console.error("Error adding document: ",x)}finally{y(!1)}};return e.createElement("div",null,o&&e.createElement("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},e.createElement("div",{className:"bg-white p-8 rounded-md shadow-md w-96"},e.createElement("div",{className:"flex justify-end"},e.createElement("button",{type:"button",className:"text-gray-500 hover:text-gray-700",onClick:A,"aria-label":"Close"},e.createElement("span",{className:"text-2xl"},"×"))),e.createElement("h5",{className:"text-2xl text-center font-bold mb-4"},"Edit profile"),e.createElement("form",null,e.createElement("div",{className:"mb-4"},e.createElement("label",{htmlFor:"bio",className:"block text-lg text-left font-medium text-gray-600"},"Bio:"),e.createElement("textarea",{className:"mt-1 p-2 w-full border rounded-md focus:outline-none focus:ring focus:border-blue-300",id:"bio",name:"bio",rows:"3",value:f.bio,onChange:v})),e.createElement("div",{className:"mb-4"},e.createElement("label",{htmlFor:"username",className:"block text-lg text-left font-medium text-gray-600"},"Username:"),e.createElement("input",{type:"text",className:"mt-1 p-2 w-full border rounded-md focus:outline-none focus:ring focus:border-blue-300",id:"username",name:"username",value:f.username,onChange:v})),e.createElement("div",{className:"mb-4"},e.createElement("label",{htmlFor:"title",className:"block text-lg text-left font-medium text-gray-600"},"Title:"),e.createElement("input",{type:"text",className:"mt-1 p-2 w-full border rounded-md focus:outline-none focus:ring focus:border-blue-300",id:"title",name:"title",value:f.title,onChange:v})),e.createElement("button",{type:"button",className:"bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring focus:border-blue-300",onClick:T},"Submit")))))},Ae=()=>{const f=ye(),[t,O]=c.useState(null),[y,v]=c.useState(!1),{setProfileImageUrl:h}=ve(),b=c.useContext(ee),o=b==null?void 0:b.uid,{userId:i}=Ne();c.useEffect(()=>{(o||i)&&(async()=>{let n;if(i)n=i;else if(!i&&o)n=o;else{console.log("User ID not provided and no authenticated user");return}const l=encodeURIComponent(n);try{const a=await fetch(`https://pralap-f9hz.onrender.com/profile/${l}`),r=await a.json();a.ok?(O(r),l===o&&h(r.pfp)):console.error("Error fetching user information:",r.error)}catch(a){console.error("Error fetching user information:",a)}})()},[i,o,h]);const A=t==null?void 0:t.username,T=t==null?void 0:t.bio,x=t==null?void 0:t.title,N=t==null?void 0:t.pfp,E=t==null?void 0:t.pfp,[k,q]=c.useState(!1),[C,S]=c.useState(null),W=()=>{console.log("clicked"),q(!0)},te=()=>{q(!1),S(null)},se=async()=>{var s;if(C){const n=X(Ce,`pfp/${o}_${C.name}`);try{await Se(n,C);const l=await Pe(n);console.log("File available at",l);const a=De(),r=p(a,"users",o);try{const d=await F(r);if(d.exists()){const m=(s=d.data())==null?void 0:s.pfp;if(m&&m.startsWith("https://firebasestorage")){const L=Ue(),D=X(L,m);try{await Fe(D),console.log("File deleted successfully")}catch(xe){console.error("Error deleting file:",xe)}}}else return console.log("User not found"),null}catch(d){return console.error("Error fetching username:",d),null}const w=p(a,"users",b==null?void 0:b.uid);await R(w,{pfp:l})}catch(l){console.error("Error uploading file:",l)}}},H=g(u,"user_sec_info"),oe=async(s,n)=>{try{const l=p(H,s);G?await R(l,{followers:Z(n)}):await R(l,{followers:Y(n)});const a=p(H,n);G?await R(a,{following:Z(s)}):await R(a,{following:Y(s)}),console.log("Connection successful!")}catch(l){console.error("Error connecting users:",l)}},[G,ae]=c.useState(!1),[le,ne]=c.useState(0),[re,ce]=c.useState(0),[ie,me]=c.useState(0);c.useEffect(()=>{const s=i||o;if(!s)return;const n=p(H,s),l=ke(n,a=>{const r=a.data()||{},w=r.followers||[];ae(w.includes(o)),ne(w.length);const d=r.following||[];ce(d.length);const m=r.public_post_count;me(m)});return()=>{l()}},[i,o]);const[$,Q]=c.useState(!1),de=()=>{Q(!$)},[z,ue]=c.useState(null),j=s=>{_([]),ue(s),s==0?(t==null?void 0:t.userId)===o?I(o):I(i):s==1?ge(o):s==2&&be(o)},fe=()=>{_([]),Q(!$),j(0)},[pe,P]=c.useState([]),I=async s=>{P([]);const n=g(u,"user_sec_info"),l=p(n,s),a=await F(l);if(a.exists()){const r=a.data().public_posts,d=(await M(B(g(u,"post"),U("postId","in",r)))).docs.map(m=>({id:m.id,...m.data()}));P(d)}else console.log(`No document found for user with ID: ${s}`)},ge=async s=>{P([]);const n=g(u,"user_sec_info"),l=p(n,s),a=await F(l);if(a.exists()){const r=a.data().private_posts,d=(await M(B(g(u,"post"),U("postId","in",r)))).docs.map(m=>({id:m.id,...m.data()}));P(d)}else console.log(`No document found for user with ID: ${s}`)},be=async s=>{P([]);const n=g(u,"user_sec_info"),l=p(n,s),a=await F(l);if(a.exists()){const r=a.data().archived,d=(await M(B(g(u,"post"),U("postId","in",r),U("public","==",!0)))).docs.map(m=>({id:m.id,...m.data()}));P(d)}else console.log(`No document found for user with ID: ${s}`)},[J,_]=c.useState([]),K=async s=>{_([]),P([]),Q(!1);const n=i||o;if(!n)return;const l=g(u,"user_sec_info"),a=p(l,n);try{const r=await F(a);if(r.exists()){const w=r.data().followers,d=r.data().following;if(s===0){const L=(await M(B(g(u,"users"),U("userId","in",w)))).docs.map(D=>({id:D.id,...D.data()}));_(L)}else if(s===1){const L=(await M(B(g(u,"users"),U("userId","in",d)))).docs.map(D=>({id:D.id,...D.data()}));_(L)}}else console.log(`No document found for user with ID: ${i}`)}catch(r){console.error("Error fetching user document:",r)}},he=s=>{_([]),f(`/profile/${s}`)};return e.createElement("main",{className:"profile-page"},e.createElement("section",{className:"relative block h-[300px] "},e.createElement("div",{className:"absolute top-0 w-full h-full bg-center bg-cover",style:{backgroundImage:`url(${E})`}})),e.createElement("section",{className:"relative py-16"},e.createElement("div",{className:"container mx-auto px-4 "},e.createElement("div",{className:"relative flex flex-col min-w-0 break-words bg-custom-light w-full mb-6 shadow-xl rounded-lg -mt-64 "},e.createElement("div",{className:"px-6"},e.createElement("div",{className:"flex flex-wrap justify-center items-center "},e.createElement("div",{className:"w-full lg:w-1/3 px-4 lg:order-2 flex justify-center items-center "},e.createElement("div",{className:"relative  "},e.createElement("img",{alt:"...",src:N,className:"shadow-xl rounded-full border-white max-h-[200px] align-middle border-none max-w-[150px]"}),(t==null?void 0:t.userId)===o&&e.createElement("button",{className:"absolute bottom-0 right-0 cursor-pointer text-black  rounded-full",onClick:W},e.createElement(Re,{icon:$e}))),e.createElement(Be,{isOpen:k,onRequestClose:te,onUpload:se,onFileChange:S})),e.createElement("div",{className:"w-full lg:w-1/3 px-4 p-4 lg:order-3 lg:text-right lg:self-center mx-auto"},e.createElement("div",{className:"text-center"},(t==null?void 0:t.userId)!==o&&e.createElement("button",{className:`${G?"bg-green-500 hover:bg-green-400 active:bg-green-600":"bg-pink-500 hover:bg-pink-400 active:bg-pink-600"} uppercase text-white font-bold hover:shadow-md shadow text-xs px-4 py-2 rounded outline-none focus:outline-none mb-1 ease-linear transition-all duration-150`,type:"button",onClick:()=>oe(t==null?void 0:t.userId,o)},G?"following":"follow"),(t==null?void 0:t.userId)===o&&e.createElement("button",{className:"bg-pink-500 hover:bg-pink-400 active:bg-pink-600 uppercase text-white font-bold hover:shadow-md shadow text-xs px-4 py-2 rounded outline-none focus:outline-none sm:mr-2 mb-1 ease-linear transition-all duration-150",type:"button",onClick:()=>v(!0)},"Edit"),y&&e.createElement(Me,null)))),e.createElement("div",{className:"text-center flex-col items-center justify-center mt-8 "},e.createElement("h3",{className:"text-4xl font-semibold leading-normal mb-2 text-blueGray-700 "},x),e.createElement("i",{className:"fas fa-university mr-2 text-lg  text-blueGray-400"}),"@",A),e.createElement("div",{className:"mt-5 py-4 text-center"},e.createElement("div",{className:"flex flex-wrap justify-center"},e.createElement("div",{className:"w-full lg:w-9/12 px-4"},e.createElement("p",{className:"mb-4 md:text-lg text-sm leading-relaxed text-custom-dark"},T)))),e.createElement("div",{className:"w-full lg:w-1/3 px-4 lg:order-1 mx-auto "},e.createElement("div",{className:"flex justify-center py-4 lg:pt-4 pt-8"},e.createElement("div",{className:"mr-4 p-3 text-center"},e.createElement("span",{className:"text-xl font-bold block uppercase tracking-wide text-blueGray-600"},le),e.createElement("span",{onClick:()=>K(0),className:" cursor-pointer text-sm text-blueGray-400"},"followers")),e.createElement("div",{className:"mr-4 p-3 text-center"},e.createElement("span",{className:"text-xl font-bold block uppercase tracking-wide text-blueGray-600"},ie),e.createElement("span",{onClick:fe,className:"text-sm cursor-pointer text-blueGray-400"},"posts")),e.createElement("div",{className:"lg:mr-4 p-3 text-center"},e.createElement("span",{className:"text-xl font-bold block uppercase tracking-wide text-blueGray-600"},re),e.createElement("span",{onClick:()=>K(1),className:" cursor-pointer text-sm text-blueGray-400"},"following"))))),e.createElement("div",{className:" text-center p-4 "},e.createElement("button",{onClick:de,className:" text-red-600 hover:text-red-400"},$?"Show Less":"Show More")),$&&(t==null?void 0:t.userId)!=o&&e.createElement("div",{className:"flex items-center md:text-lg text-sm justify-evenly"},e.createElement("div",{className:` cursor-pointer text-custom-dark ${z===0?"selected":""}`,onClick:()=>j(0)},"Posts")),$&&(t==null?void 0:t.userId)===o&&e.createElement("div",{className:"flex items-center md:text-lg text-sm justify-evenly"},e.createElement("div",{className:`cursor-pointer text-custom-dark ${z===0?"selected":""}`,onClick:()=>j(0)},"Public"),e.createElement("div",{className:`cursor-pointer text-custom-dark ${z===1?"selected":""}`,onClick:()=>j(1)},"Private"),e.createElement("div",{className:`cursor-pointer text-custom-dark ${z===2?"selected":""}`,onClick:()=>j(2)},"Archive"))))),$&&e.createElement("div",null,pe.slice(0,10).map(s=>s?e.createElement(_e,{key:s.id,post:s}):null)),J&&e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 container mx-auto mb-4"},J.map(s=>e.createElement("div",{key:s.id,className:"bg-custom-light p-4 rounded-3xl mx-3 shadow-md",onClick:()=>he(s.userId)},e.createElement("div",{className:"flex items-center "},e.createElement("img",{src:s.pfp,alt:"profile",className:"h-12 w-12 rounded-full"}),e.createElement("div",{className:"ml-4"},e.createElement("h2",{className:"text-xl font-semibold"},s.title),e.createElement("p",{className:"text-gray-500"},"@",s.username)))))))};export{Ae as default};
